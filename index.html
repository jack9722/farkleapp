<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farkle Score Tracker</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e1b4b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Farkle Tracker">
    <link rel="apple-touch-icon" href="icon-192.png">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Add Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        body { 
            margin: 0; 
            overflow-x: hidden; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Initialize Firebase with the provided config
        const firebaseConfig = {
            apiKey: "AIzaSyB1icTUb7XlprSytZKEJreneb1EyfbACCI",
            authDomain: "farklescoretracker.firebaseapp.com",
            projectId: "farklescoretracker",
            storageBucket: "farklescoretracker.firebasestorage.app",
            messagingSenderId: "838671539834",
            appId: "1:838671539834:web:025bf412be8a817e4825c3"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Lucide React icons as components
        const Plus = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M12 5v14M5 12h14"/>
            </svg>
        );

        const Trophy = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/>
                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/>
                <path d="M4 22h16"/>
                <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/>
                <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/>
                <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/>
            </svg>
        );

        const Users = ({ size = 16 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
        );

        const RotateCcw = ({ size = 16 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                <path d="M3 3v5h5"/>
            </svg>
        );

        const ChevronRight = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M9 18l6-6-6-6"/>
            </svg>
        );

        const Crown = ({ size = 16 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M11.562 3.266a.5.5 0 0 1 .876 0L14.986 8.5l4.986-.963a.5.5 0 0 1 .593.644L18.5 18.5a2 2 0 0 1-2 1.5h-9a2 2 0 0 1-2-1.5L3.435 8.181a.5.5 0 0 1 .593-.644L9.014 8.5l2.548-5.234Z"/>
            </svg>
        );

        const FarkleScoreApp = () => {
            const [mode, setMode] = useState(null); // null, "offline", "host", "join"
            const [roomCode, setRoomCode] = useState('');
            const [username, setUsername] = useState('');
            const [deviceId, setDeviceId] = useState('');
            const [gameState, setGameState] = useState(null);
            const [players, setPlayers] = useState([]);
            const [newPlayerName, setNewPlayerName] = useState('');
            const [gameStarted, setGameStarted] = useState(false);
            const [orderSelecting, setOrderSelecting] = useState(false);
            const [currentPlayerIndex, setCurrentPlayerIndex] = useState(0);
            const [currentTurnScore, setCurrentTurnScore] = useState(0);
            const [winningScore, setWinningScore] = useState(10000);
            const [turnOrder, setTurnOrder] = useState([]);
            const [error, setError] = useState('');

            // Sign in anonymously to get a device ID
            useEffect(() => {
                auth.signInAnonymously()
                    .then((userCredential) => {
                        setDeviceId(userCredential.user.uid);
                    })
                    .catch((error) => {
                        console.error("Anonymous auth failed:", error);
                    });
            }, []);

            // Host a game
            const hostGame = async () => {
                if (!username.trim()) {
                    setError("Please enter a username");
                    return;
                }
                setError('');
                try {
                    const gameRef = await db.collection('games').add({
                        winningScore: winningScore,
                        currentPlayerIndex: 0,
                        players: [{ id: deviceId, username: username.trim(), score: 0 }],
                        turnOrder: [deviceId],
                        currentTurnScore: 0,
                        gameStarted: false
                    });
                    setRoomCode(gameRef.id);
                    setMode('host');
                    // Listen for game state updates
                    gameRef.onSnapshot((snapshot) => {
                        const data = snapshot.data();
                        if (data) {
                            setGameState(data);
                            setPlayers(data.players || []);
                            setTurnOrder(data.turnOrder || []);
                            setCurrentPlayerIndex(data.currentPlayerIndex || 0);
                            setCurrentTurnScore(data.currentTurnScore || 0);
                            setGameStarted(data.gameStarted || false);
                        }
                    });
                } catch (err) {
                    setError("Failed to create game: " + err.message);
                }
            };

            // Join a game
            const joinGame = async () => {
                if (!roomCode.trim() || !username.trim()) {
                    setError("Please enter both a room code and username");
                    return;
                }
                setError('');
                try {
                    const gameRef = db.collection('games').doc(roomCode.trim());
                    const gameDoc = await gameRef.get();
                    if (!gameDoc.exists) {
                        setError("Room code not found");
                        return;
                    }
                    const gameData = gameDoc.data();
                    if (gameData.gameStarted) {
                        setError("Game has already started");
                        return;
                    }
                    const newPlayer = { id: deviceId, username: username.trim(), score: 0 };
                    await gameRef.update({
                        players: [...gameData.players, newPlayer],
                        turnOrder: [...gameData.turnOrder, deviceId]
                    });
                    setMode('join');
                    // Listen for game state updates
                    gameRef.onSnapshot((snapshot) => {
                        const data = snapshot.data();
                        if (data) {
                            setGameState(data);
                            setPlayers(data.players || []);
                            setTurnOrder(data.turnOrder || []);
                            setCurrentPlayerIndex(data.currentPlayerIndex || 0);
                            setCurrentTurnScore(data.currentTurnScore || 0);
                            setGameStarted(data.gameStarted || false);
                        }
                    });
                } catch (err) {
                    setError("Failed to join game: " + err.message);
                }
            };

            // Start the online game (host only)
            const startOnlineGame = async () => {
                if (players.length < 2) {
                    setError("Need at least 2 players to start");
                    return;
                }
                setError('');
                try {
                    const gameRef = db.collection('games').doc(roomCode);
                    await gameRef.update({
                        gameStarted: true,
                        currentPlayerIndex: 0,
                        currentTurnScore: 0
                    });
                } catch (err) {
                    setError("Failed to start game: " + err.message);
                }
            };

            // Offline mode functions (unchanged)
            const addPlayer = () => {
                if (newPlayerName.trim() && !gameStarted) {
                    setPlayers([...players, { 
                        id: Date.now(), 
                        name: newPlayerName.trim(), 
                        score: 0
                    }]);
                    setNewPlayerName('');
                }
            };

            const selectOrder = () => {
                if (players.length >= 2) {
                    setOrderSelecting(true);
                    let shuffleCount = 0;
                    const maxShuffles = 15;
                    const shuffleInterval = setInterval(() => {
                        const shuffled = [...players].sort(() => Math.random() - 0.5);
                        setPlayers(shuffled);
                        shuffleCount++;
                        if (shuffleCount >= maxShuffles) {
                            clearInterval(shuffleInterval);
                            setTimeout(() => {
                                setOrderSelecting(false);
                                setGameStarted(true);
                                setTurnOrder([...shuffled]);
                                setPlayers(shuffled.map(player => ({ ...player, score: 0 })));
                                setCurrentPlayerIndex(0);
                                setCurrentTurnScore(0);
                            }, 500);
                        }
                    }, 150);
                }
            };

            const startGame = selectOrder;

            const resetGame = () => {
                setGameStarted(false);
                setOrderSelecting(false);
                setPlayers(players.map(player => ({ ...player, score: 0 })));
                setTurnOrder([]);
                setCurrentPlayerIndex(0);
                setCurrentTurnScore(0);
                if (mode === 'host' || mode === 'join') {
                    setMode(null);
                    setRoomCode('');
                    setUsername('');
                    setGameState(null);
                }
            };

            // Update turn score (online and offline)
            const updateTurnScore = async (points) => {
                const newScore = Math.max(0, currentTurnScore + points);
                if (mode === 'offline') {
                    setCurrentTurnScore(newScore);
                } else {
                    const gameRef = db.collection('games').doc(roomCode);
                    await gameRef.update({ currentTurnScore: newScore });
                }
            };

            // Bank score and move to next player
            const bankAndNext = async () => {
                if (mode === 'offline') {
                    const updatedPlayers = [...players];
                    updatedPlayers[currentPlayerIndex].score += currentTurnScore;
                    setPlayers(updatedPlayers);
                    nextPlayer();
                } else {
                    const gameRef = db.collection('games').doc(roomCode);
                    const player = players[currentPlayerIndex];
                    const updatedPlayers = [...players];
                    updatedPlayers[currentPlayerIndex] = { ...player, score: player.score + currentTurnScore };
                    const nextIndex = (currentPlayerIndex + 1) % players.length;
                    await gameRef.update({
                        players: updatedPlayers,
                        currentPlayerIndex: nextIndex,
                        currentTurnScore: 0
                    });
                }
            };

            // Farkle and move to next player
            const farkleAndNext = async () => {
                if (mode === 'offline') {
                    nextPlayer();
                } else {
                    const gameRef = db.collection('games').doc(roomCode);
                    const nextIndex = (currentPlayerIndex + 1) % players.length;
                    await gameRef.update({
                        currentPlayerIndex: nextIndex,
                        currentTurnScore: 0
                    });
                }
            };

            const nextPlayer = () => {
                setCurrentTurnScore(0);
                setCurrentPlayerIndex((currentPlayerIndex + 1) % players.length);
            };

            const currentPlayer = players[currentPlayerIndex];
            const sortedPlayers = [...players].sort((a, b) => b.score - a.score);
            const leader = sortedPlayers[0];
            const winner = players.find(player => player.score >= winningScore);

            const getStanding = (player) => {
                const rank = sortedPlayers.findIndex(p => p.id === player.id) + 1;
                const behindBy = leader && leader.id !== player.id ? leader.score - player.score : 0;
                return { rank, behindBy };
            };

            const isMyTurn = () => {
                if (mode === 'offline') return true;
                return turnOrder[currentPlayerIndex] === deviceId;
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900">
                    {/* Header */}
                    <div className="bg-black/20 backdrop-blur-md border-b border-white/10 p-4">
                        <div className="flex items-center justify-center gap-2">
                            <Trophy size={24} />
                            <h1 className="text-xl font-bold text-white">Johnson Farkle</h1>
                        </div>
                    </div>

                    <div className="p-4 space-y-4 pb-24">
                        {/* Mode Selection Screen */}
                        {!mode && (
                            <div className="bg-white/10 backdrop-blur-md rounded-lg p-4 border border-white/20">
                                <h2 className="text-white text-lg font-bold mb-4">Select Mode</h2>
                                <button
                                    onClick={() => setMode('offline')}
                                    className="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors mb-2"
                                >
                                    Offline Mode (Single Device)
                                </button>
                                <button
                                    onClick={() => setMode('host')}
                                    className="w-full py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors mb-2"
                                >
                                    Host Online Game
                                </button>
                                <button
                                    onClick={() => setMode('join')}
                                    className="w-full py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition-colors"
                                >
                                    Join Online Game
                                </button>
                            </div>
                        )}

                        {/* Host Game Screen */}
                        {mode === 'host' && !gameStarted && (
                            <div className="bg-white/10 backdrop-blur-md rounded-lg p-4 border border-white/20">
                                {!roomCode ? (
                                    <>
                                        <div className="mb-4">
                                            <label className="block text-white font-medium mb-2">Your Username</label>
                                            <input
                                                type="text"
                                                value={username}
                                                onChange={(e) => setUsername(e.target.value)}
                                                placeholder="Enter your username"
                                                className="w-full px-3 py-2 rounded bg-white/20 text-white placeholder-white/50 border border-white/30"
                                            />
                                        </div>
                                        <div className="mb-4">
                                            <label className="block text-white font-medium mb-2">Winning Score</label>
                                            <input
                                                type="number"
                                                value={winningScore}
                                                onChange={(e) => setWinningScore(parseInt(e.target.value) || 10000)}
                                                className="w-full px-3 py-2 rounded bg-white/20 text-white placeholder-white/50 border border-white/30"
                                            />
                                        </div>
                                        {error && <p className="text-red-400 mb-2">{error}</p>}
                                        <button
                                            onClick={hostGame}
                                            className="w-full py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-bold transition-colors"
                                        >
                                            Create Game
                                        </button>
                                    </>
                                ) : (
                                    <>
                                        <h2 className="text-white text-lg font-bold mb-4">Room Code: {roomCode}</h2>
                                        <p className="text-white mb-2">Share this code with others to join!</p>
                                        <div className="mb-4">
                                            <h3 className="text-white font-medium mb-2">Players ({players.length})</h3>
                                            <div className="space-y-2">
                                                {players.map((player, index) => (
                                                    <div key={player.id} className="flex items-center justify-between bg-white/10 rounded p-2">
                                                        <span className="text-white">{index + 1}. {player.username}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                        {error && <p className="text-red-400 mb-2">{error}</p>}
                                        <button
                                            onClick={startOnlineGame}
                                            className="w-full py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-bold transition-colors"
                                        >
                                            Start Game
                                        </button>
                                    </>
                                )}
                            </div>
                        )}

                        {/* Join Game Screen */}
                        {mode === 'join' && !gameStarted && (
                            <div className="bg-white/10 backdrop-blur-md rounded-lg p-4 border border-white/20">
                                {!roomCode ? (
                                    <>
                                        <div className="mb-4">
                                            <label className="block text-white font-medium mb-2">Room Code</label>
                                            <input
                                                type="text"
                                                value={roomCode}
                                                onChange={(e) => setRoomCode(e.target.value)}
                                                placeholder="Enter room code"
                                                className="w-full px-3 py-2 rounded bg-white/20 text-white placeholder-white/50 border border-white/30"
                                            />
                                        </div>
                                        <div className="mb-4">
                                            <label className="block text-white font-medium mb-2">Your Username</label>
                                            <input
                                                type="text"
                                                value={username}
                                                onChange={(e) => setUsername(e.target.value)}
                                                placeholder="Enter your username"
                                                className="w-full px-3 py-2 rounded bg-white/20 text-white placeholder-white/50 border border-white/30"
                                            />
                                        </div>
                                        {error && <p className="text-red-400 mb-2">{error}</p>}
                                        <button
                                            onClick={joinGame}
                                            className="w-full py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-bold transition-colors"
                                        >
                                            Join Game
                                        </button>
                                    </>
                                ) : (
                                    <div className="text-center">
                                        <h2 className="text-white text-lg font-bold mb-4">Waiting for Host to Start...</h2>
                                        <p className="text-white mb-2">Room Code: {roomCode}</p>
                                        <div className="flex items-center justify-center gap-2 text-white/70">
                                            <div className="w-2 h-2 bg-white rounded-full animate-bounce"></div>
                                            <div className="w-2 h-2 bg-white rounded-full animate-bounce" style={{animationDelay: '0.1s'}}></div>
                                            <div className="w-2 h-2 bg-white rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Offline Setup Screen */}
                        {mode === 'offline' && !gameStarted && !orderSelecting && (
                            <div className="bg-white/10 backdrop-blur-md rounded-lg p-4 border border-white/20">
                                <div className="mb-4">
                                    <label className="block text-white font-medium mb-2">Winning Score</label>
                                    <input
                                        type="number"
                                        value={winningScore}
                                        onChange={(e) => setWinningScore(parseInt(e.target.value) || 10000)}
                                        className="w-full px-3 py-2 rounded bg-white/20 text-white placeholder-white/50 border border-white/30"
                                    />
                                </div>

                                <div className="mb-4">
                                    <label className="block text-white font-medium mb-2">Add Players</label>
                                    <div className="flex gap-2">
                                        <input
                                            type="text"
                                            value={newPlayerName}
                                            onChange={(e) => setNewPlayerName(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && addPlayer()}
                                            placeholder="Player name"
                                            className="flex-1 px-3 py-2 rounded bg-white/20 text-white placeholder-white/50 border border-white/30"
                                        />
                                        <button
                                            onClick={addPlayer}
                                            className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded font-medium transition-colors"
                                        >
                                            <Plus />
                                        </button>
                                    </div>
                                </div>

                                {players.length > 0 && (
                                    <div className="mb-4">
                                        <h3 className="text-white font-medium mb-2">Players ({players.length})</h3>
                                        <div className="space-y-2">
                                            {players.map((player, index) => (
                                                <div key={player.id} className="flex items-center justify-between bg-white/10 rounded p-2">
                                                    <span className="text-white">{index + 1}. {player.name}</span>
                                                    <button
                                                        onClick={() => setPlayers(players.filter(p => p.id !== player.id))}
                                                        className="text-red-400 hover:text-red-300 px-2 py-1"
                                                    >
                                                        ×
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                <button
                                    onClick={startGame}
                                    disabled={players.length < 2}
                                    className="w-full py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg font-bold text-lg transition-colors"
                                >
                                    {players.length < 2 ? 'Need 2+ Players' : 'Randomize Turn Order & Start!'}
                                </button>
                            </div>
                        )}

                        {/* Order Selection Animation (Offline Mode) */}
                        {mode === 'offline' && orderSelecting && (
                            <div className="bg-white/10 backdrop-blur-md rounded-lg p-6 border border-white/20 text-center">
                                <div className="mb-4">
                                    <h2 className="text-2xl font-bold text-white mb-2">🎲 Selecting Turn Order 🎲</h2>
                                    <p className="text-white/70">Rolling the dice to decide who goes first...</p>
                                </div>

                                <div className="space-y-3 mb-6">
                                    {players.map((player, index) => (
                                        <div
                                            key={player.id}
                                            className={`p-4 rounded-lg transition-all duration-150 transform ${
                                                index === 0 ? 'bg-yellow-500/30 scale-105 border-2 border-yellow-400' : 'bg-white/10'
                                            }`}
                                            style={{
                                                animation: 'pulse 0.15s ease-in-out'
                                            }}
                                        >
                                            <div className="flex items-center justify-center gap-3">
                                                <span className="text-2xl font-bold text-white">#{index + 1}</span>
                                                <span className="text-lg font-medium text-white">{player.name}</span>
                                                {index === 0 && <span className="text-yellow-400">👑</span>}
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                <div className="flex items-center justify-center gap-2 text-white/70">
                                    <div className="w-2 h-2 bg-white rounded-full animate-bounce"></div>
                                    <div className="w-2 h-2 bg-white rounded-full animate-bounce" style={{animationDelay: '0.1s'}}></div>
                                    <div className="w-2 h-2 bg-white rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
                                </div>
                            </div>
                        )}

                        {/* Game Screen (Offline and Online) */}
                        {(gameStarted || (mode !== 'offline' && gameState?.gameStarted)) && (
                            <>
                                {/* Winner Announcement */}
                                {winner && (
                                    <div className="bg-gradient-to-r from-yellow-400 to-orange-500 rounded-lg p-4 text-center">
                                        <Crown size={32} />
                                        <h2 className="text-xl font-bold text-white">🎉 {mode === 'offline' ? winner.name : winner.username} Wins! 🎉</h2>
                                        <p className="text-white">{winner.score.toLocaleString()} points</p>
                                    </div>
                                )}

                                {/* Turn Order Display */}
                                {turnOrder.length > 0 && !winner && (
                                    <div className="bg-white/10 backdrop-blur-md rounded-lg border border-white/20">
                                        <div className="p-3 border-b border-white/10">
                                            <h2 className="text-white font-bold text-lg">Turn Order</h2>
                                        </div>
                                        <div className="space-y-1">
                                            {turnOrder.map((playerId, index) => {
                                                const player = players.find(p => p.id === playerId);
                                                const isCurrentPlayer = index === currentPlayerIndex;
                                                const isNextPlayer = index === (currentPlayerIndex + 1) % turnOrder.length;
                                                return (
                                                    <div
                                                        key={playerId}
                                                        className={`p-2 flex items-center justify-between ${
                                                            isCurrentPlayer ? 'bg-blue-500/30 border-l-4 border-blue-400' : ''
                                                        } ${isNextPlayer ? 'bg-green-500/20' : ''}`}
                                                    >
                                                        <div className="flex items-center gap-2">
                                                            <span className="text-white font-medium">{index + 1}.</span>
                                                            <span className="text-white font-medium">{mode === 'offline' ? player.name : player.username}</span>
                                                            {isCurrentPlayer && <span className="text-blue-300 text-sm">Current</span>}
                                                            {isNextPlayer && <span className="text-green-300 text-sm">Next</span>}
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}

                                {/* Live Leaderboard */}
                                <div className="bg-white/10 backdrop-blur-md rounded-lg border border-white/20">
                                    <div className="p-3 border-b border-white/10">
                                        <h2 className="text-white font-bold text-lg">Leaderboard</h2>
                                    </div>
                                    <div className="space-y-0">
                                        {sortedPlayers.map((player, index) => {
                                            const standing = getStanding(player);
                                            const isCurrentPlayer = player.id === currentPlayer?.id;
                                            return (
                                                <div
                                                    key={player.id}
                                                    className={`p-2 flex items-center justify-between ${
                                                        isCurrentPlayer ? 'bg-blue-500/30 border-l-4 border-blue-400' : ''
                                                    } ${index === 0 ? 'bg-yellow-500/20' : ''}`}
                                                >
                                                    <div className="flex items-center gap-2">
                                                        <div className="flex items-center gap-1">
                                                            {index === 0 && <Crown size={14} />}
                                                            <span className="text-white font-medium text-sm">#{standing.rank}</span>
                                                        </div>
                                                        <div>
                                                            <div className="text-white font-medium text-sm">{mode === 'offline' ? player.name : player.username}</div>
                                                            {standing.behindBy > 0 && (
                                                                <div className="text-red-300 text-xs">-{standing.behindBy.toLocaleString()}</div>
                                                            )}
                                                        </div>
                                                    </div>
                                                    <div className="text-right">
                                                        <div className="text-white font-semibold text-base">
                                                            {player.score.toLocaleString()}
                                                        </div>
                                                        {isCurrentPlayer && currentTurnScore > 0 && (
                                                            <div className="text-green-300 text-xs">+{currentTurnScore}</div>
                                                        )}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>

                                {/* Current Turn */}
                                {currentPlayer && !winner && (
                                    <div className="bg-white/10 backdrop-blur-md rounded-lg border border-white/20">
                                        <div className="sticky top-0 bg-white/30 backdrop-blur-md rounded-t-lg border-b border-white/20 z-10">
                                            <div className="text-center p-4">
                                                <h3 className="text-white text-xl font-bold">{mode === 'offline' ? currentPlayer.name : currentPlayer.username}'s Turn</h3>
                                                <div className="mt-2 flex items-center justify-center space-x-4">
                                                    <div>
                                                        <div className="text-2xl font-bold text-green-400">
                                                            {currentTurnScore.toLocaleString()}
                                                        </div>
                                                        <div className="text-white/70 text-sm">Turn Score</div>
                                                    </div>
                                                    <div className="h-10 w-px bg-white/20"></div>
                                                    <div>
                                                        <div className="text-2xl font-bold text-blue-300">
                                                            {(currentPlayer.score + currentTurnScore).toLocaleString()}
                                                        </div>
                                                        <div className="text-white/70 text-sm">Total if Banked</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Quick Score Buttons */}
                                        <div className="p-4 space-y-3">
                                            {/* Single Die Scores */}
                                            <div className="grid grid-cols-3 gap-2">
                                                <button
                                                    onClick={() => updateTurnScore(50)}
                                                    disabled={!isMyTurn()}
                                                    className={`py-3 bg-green-600/80 hover:bg-green-600 text-white rounded font-medium transition-colors text-sm ${!isMyTurn() ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                >
                                                    Single 5<br />+50
                                                </button>
                                                <button
                                                    onClick={() => updateTurnScore(100)}
                                                    disabled={!isMyTurn()}
                                                    className={`py-3 bg-green-600/80 hover:bg-green-600 text-white rounded font-medium transition-colors text-sm ${!isMyTurn() ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                >
                                                    Single 1<br />+100
                                                </button>
                                                <button
                                                    onClick={() => updateTurnScore(750)}
                                                    disabled={!isMyTurn()}
                                                    className={`py-3 bg-green-600/80 hover:bg-green-600 text-white rounded font-medium transition-colors text-sm ${!isMyTurn() ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                >
                                                    Three 1s<br />+750
                                                </button>
                                            </div>

                                            {/* Triple Scores */}
                                            <div className="grid grid-cols-3 gap-2">
                                                <button
                                                    onClick={() => updateTurnScore(200)}
                                                    disabled={!isMyTurn()}
                                                    className={`py-3 bg-green-600/80 hover:bg-green-600 text-white rounded font-medium transition-colors text-sm ${!isMyTurn() ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                >
                                                    Three 2s<br />+200
                                                </button>
                                                <button
                                                    onClick={() => updateTurnScore(300)}
                                                    disabled={!isMyTurn()}
                                                    className={`py-3 bg-green-600/80 hover:bg-green-600 text-white rounded font-medium transition-colors text-sm ${!isMyTurn() ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                >
                                                    Three 3s<br />+300
                                                </button>
                                                <button
                                                    onClick={() => updateTurnScore(400)}
                                                    disabled={!isMyTurn()}
                                                    className={`py-3 bg-green-600/80 hover:bg-green-600 text-white rounded font-medium transition-colors text-sm ${!isMyTurn() ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                >
                                                    Three 4s<br />+400
                                                </button>
                                            </div>

                                            <div className="grid grid-cols-2 gap-2">
                                                <button
                                                    onClick={() => updateTurnScore(500)}
                                                    disabled={!isMyTurn()}
                                                    className={`py-3 bg-green-600/80 hover:bg-green-600 text-white rounded font-medium transition-colors text-sm ${!isMyTurn() ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                >
                                                    Three 5s<br />+500
                                                </button>
                                                <button
                                                    onClick={() => updateTurnScore(600)}
                                                    disabled={!isMyTurn()}
                                                    className={`py-3 bg-green-600/80 hover:bg-green-600 text-white rounded font-medium transition-colors text-sm ${!isMyTurn() ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                >
                                                    Three 6s<br />+600
                                                </button>
                                            </div>

                                            {/* Special Combinations */}
                                            <div className="grid grid-cols-2 gap-2">
                                                <button
                                                    onClick={() => updateTurnScore(150)}
                                                    disabled={!isMyTurn()}
                                                    className={`py-3 bg-blue-600/80 hover:bg-blue-600 text-white rounded font-medium transition-colors text-sm ${!isMyTurn() ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                >
                                                    Micro Straight<br />+150
                                                </button>
                                                <button
                                                    onClick={() => updateTurnScore(1000)}
                                                    disabled={!isMyTurn()}
                                                    className={`py-3 bg-blue-600/80 hover:bg-blue-600 text-white rounded font-medium transition-colors text-sm ${!isMyTurn() ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                >
                                                    Small Straight<br />+1000
                                                </button>
                                                <button
                                                    onClick={() => updateTurnScore(1500)}
                                                    disabled={!isMyTurn()}
                                                    className={`py-3 bg-blue-600/80 hover:bg-blue-600 text-white rounded font-medium transition-colors text-sm col-span-2 ${!isMyTurn() ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                >
                                                    Straight<br />+1500
                                                </button>
                                            </div>

                                            {/* High Scores */}
                                            <div className="grid grid-cols-2 gap-2">
                                                <button
                                                    onClick={() => updateTurnScore(1500)}
                                                    disabled={!isMyTurn()}
                                                    className={`py-3 bg-purple-600/80 hover:bg-purple-600 text-white rounded font-medium transition-colors text-sm ${!isMyTurn() ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                >
                                                    Four of Kind<br />+1500
                                                </button>
                                                <button
                                                    onClick={() => updateTurnScore(2000)}
                                                    disabled={!isMyTurn()}
                                                    className={`py-3 bg-purple-600/80 hover:bg-purple-600 text-white rounded font-medium transition-colors text-sm ${!isMyTurn() ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                >
                                                    Five of Kind<br />+2000
                                                </button>
                                            </div>

                                            <button
                                                onClick={() => updateTurnScore(3000)}
                                                disabled={!isMyTurn()}
                                                className={`w-full py-3 bg-purple-600/80 hover:bg-purple-600 text-white rounded font-medium transition-colors ${!isMyTurn() ? 'opacity-50 cursor-not-allowed' : ''}`}
                                            >
                                                Six of a Kind<br />+3000
                                            </button>

                                            {/* Special Actions */}
                                            <div className="grid grid-cols-2 gap-2">
                                                <button
                                                    onClick={() => updateTurnScore(-50)}
                                                    disabled={!isMyTurn()}
                                                    className={`py-3 bg-yellow-600/80 hover:bg-yellow-600 text-white rounded font-medium transition-colors text-sm ${!isMyTurn() ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                >
                                                    Undo<br />-50
                                                </button>
                                                <button
                                                    onClick={async () => {
                                                        if (mode === 'offline') {
                                                            const updatedPlayers = [...players];
                                                            const currentPlayerScore = updatedPlayers[currentPlayerIndex].score;
                                                            updatedPlayers[currentPlayerIndex].score = Math.floor(currentPlayerScore / 2);
                                                            setPlayers(updatedPlayers);
                                                            setCurrentTurnScore(0);
                                                        } else {
                                                            const gameRef = db.collection('games').doc(roomCode);
                                                            const player = players[currentPlayerIndex];
                                                            const updatedPlayers = [...players];
                                                            updatedPlayers[currentPlayerIndex] = { ...player, score: Math.floor(player.score / 2) };
                                                            await gameRef.update({
                                                                players: updatedPlayers,
                                                                currentTurnScore: 0
                                                            });
                                                        }
                                                    }}
                                                    disabled={!isMyTurn()}
                                                    className={`py-3 bg-red-700/80 hover:bg-red-700 text-white rounded font-medium transition-colors text-sm ${!isMyTurn() ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                >
                                                    🤑 Greedy Farkle 🤑<br />½ Score
                                                </button>
                                            </div>
                                        </div>

                                        {/* Turn Actions */}
                                        <div className="sticky bottom-0 bg-white/30 backdrop-blur-md rounded-t-lg border-t border-white/20 p-4 z-10">
                                            <div className="max-w-xs mx-auto space-y-2">
                                                <button
                                                    onClick={bankAndNext}
                                                    disabled={currentTurnScore === 0 || !isMyTurn()}
                                                    className={`w-full py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg font-bold text-base transition-colors flex items-center justify-center gap-2 ${!isMyTurn() ? 'opacity-50' : ''}`}
                                                >
                                                    Bank & Next Player
                                                    <ChevronRight size={16} />
                                                </button>

                                                <button
                                                    onClick={farkleAndNext}
                                                    disabled={!isMyTurn()}
                                                    className={`w-full py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-bold text-base transition-colors flex items-center justify-center gap-2 ${!isMyTurn() ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                >
                                                    Farkle! Next Player
                                                    <ChevronRight size={16} />
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Reset Button */}
                                <button
                                    onClick={resetGame}
                                    className="w-full py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2"
                                >
                                    <RotateCcw size={16} />
                                    Reset Game
                                </button>
                            </>
                        )}
                    </div>
                </div>
            );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(FarkleScoreApp));
    </script>

    <script>
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(error => console.log('SW registration failed'));
            });
        }
    </script>
</body>
</html>
